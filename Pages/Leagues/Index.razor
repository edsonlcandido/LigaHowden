@page "/leagues"
@using LigaHowden.Data.DomainModels
@using System.Text.Json
@using LigaHowden.Data
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using System.Text.Json
@using static System.Net.WebRequestMethods
@inject LigaHowden.Services.LeagueService leagueService


<div class="row mt-4">
    <div class="d-flex align-items-center">
        <h1>Ligas</h1>
        <NavLink href="@($"/leagues/add")" class="btn btn-primary my-6"><span class="oi oi-plus"></span></NavLink>
    </div>
</div>
<div class="row">
    <table class="table table-sm">
        <tr>
            <th>Nome</th>
            <th>Slug</th>
            <th>Ações</th>
        </tr>
        @foreach (var l in leagues)
        {
            <tr>
                <td>@l.Name</td>
                <td>@l.Slug</td>
                <td>
                    <NavLink href="@($"/leagues/{l.Slug}")">ver</NavLink>
                    <NavLink href="@($"/leagues/admin/{l.Slug}")">admin</NavLink>
                    <NavLink href="@($"/leagues/delete/{l.Slug}")">deletar</NavLink>
                </td>
            </tr>
        }
    </table>
</div>


@code {
    List<League>? leagues = new List<League>();

    //load leagues from the server after page is loaded
    protected override async Task OnInitializedAsync()
    {
        // LeagueService leaguesService = new LeagueService();
        // var token = await sessionStorage.GetAsync<string>("apiToken");
        // _http.DefaultRequestHeaders.Add("Authorization", token.Value);
        // var response = await _http.GetAsync("/api/collections/leagues/records");
        // var content = await response.Content.ReadAsStringAsync();
        // var leaguesResponse = JsonSerializer.Deserialize<LeaguesPocketBaseResponse>(content);
        //LeagueService leagueService = new LeagueService();



        leagues = await leagueService.GetLeaguesList();


        //this.leagues = leaguesService.GetLeaguesResponse().Leagues;
    }

    protected override async Task OnParametersSetAsync()
    {
        leagues = await leagueService.GetLeaguesList();
    }

}
